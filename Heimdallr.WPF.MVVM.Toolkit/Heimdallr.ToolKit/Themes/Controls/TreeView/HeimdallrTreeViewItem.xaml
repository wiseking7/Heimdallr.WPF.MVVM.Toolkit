<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cnvts="clr-namespace:Heimdallr.ToolKit.Converters"
    xmlns:ctrls="clr-namespace:Heimdallr.ToolKit.UI.Controls"
    xmlns:enums="clr-namespace:Heimdallr.ToolKit.Enums">

  <Style TargetType="{x:Type ctrls:HeimdallrTreeViewItem}">
    <Setter Property="SelectionCommand" 
            Value="{Binding RelativeSource={RelativeSource 
                      AncestorType=ctrls:HeimdallrTreeView}, 
                        Path=DataContext.SelectionCommand}" />
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type ctrls:HeimdallrTreeViewItem}">
          <StackPanel>
            <!-- 헤더 영역표기 -->
            <Grid x:Name="Item" Background="{TemplateBinding Background}" Height="36">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Grid.ColumnSpan="2"
                          Margin="{Binding Depth, Converter={cnvts:DepthConverter}}">
                <!-- 사용자 지정 업/다운 아이콘 Viewbox -->
                <Viewbox x:Name="ExpandCollapseIcon" Margin="{TemplateBinding Margin}"
                         Height="{TemplateBinding IconHeight}"
                         Width="{TemplateBinding IconWidth}">
                  <Path x:Name="ExpandCollapsePath"
                        Fill="{TemplateBinding Fill}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Data="{TemplateBinding Data}"/>
                </Viewbox>

                <!-- 이미지 아이콘 (사용자가 Image 지정한 경우) -->
                <Image x:Name="ItemImage"
                      Width="{TemplateBinding IconWidth}"
                      Height="{TemplateBinding IconHeight}"
                      Source="{TemplateBinding Source}"
                      Visibility="Collapsed"
                       Stretch="UniformToFill"
                      Margin="{TemplateBinding Margin}"/>

                <!-- 헤더 텍스트 -->
                <TextBlock Text="{TemplateBinding Header}" VerticalAlignment="Center" Margin="5 0 0 0"/>
              </StackPanel>
            </Grid>

            <!-- 자식 항목 -->
            <ItemsPresenter x:Name="Items" Margin="20,0,0,0" Visibility="Collapsed"/>
          </StackPanel>

          <ControlTemplate.Triggers>
            <!-- 확장 트리거 -->
            <Trigger Property="IsExpanded" Value="True">
              <Setter TargetName="Items" Property="Visibility" Value="Visible"/>
            </Trigger>

            <!-- 마우스 오버 및 선택 시 배경 -->
            <Trigger Property="IsSelected" Value="True">
              <Setter TargetName="Item" Property="Background" Value="#004EFF"/>
            </Trigger>
            <Trigger Property="IsMouseOver" Value="True">
              <Setter TargetName="Item" Property="Background" Value="Transparent"/>
            </Trigger>

            <!-- 모드에 따라 이미지/패스 표시 -->
            <Trigger Property="Mode" Value="Image">
              <Setter TargetName="ItemImage" Property="Visibility" Value="Visible"/>
              <Setter TargetName="ExpandCollapseIcon" Property="Visibility" Value="Collapsed"/>
            </Trigger>
            <Trigger Property="Mode" Value="Icon">
              <Setter TargetName="ItemImage" Property="Visibility" Value="Collapsed"/>
              <Setter TargetName="ExpandCollapseIcon" Property="Visibility" Value="Visible"/>
            </Trigger>
            <Trigger Property="Mode" Value="PathIcon">
              <Setter TargetName="ItemImage" Property="Visibility" Value="Collapsed"/>
              <Setter TargetName="ExpandCollapseIcon" Property="Visibility" Value="Visible"/>
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>
